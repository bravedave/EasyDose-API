(function($){var $w=$(window);$.fn.visible=function(partial,hidden,direction,container){if(this.length<1)
return;direction=direction||'both';var $t=this.length>1?this.eq(0):this,isContained=typeof container!=='undefined'&&container!==null,$c=isContained?$(container):$w,wPosition=isContained?$c.position():0,t=$t.get(0),vpWidth=$c.outerWidth(),vpHeight=$c.outerHeight(),clientSize=hidden===!0?t.offsetWidth*t.offsetHeight:!0;if(typeof t.getBoundingClientRect==='function'){var rec=t.getBoundingClientRect(),tViz=isContained?rec.top-wPosition.top>=0&&rec.top<vpHeight+wPosition.top:rec.top>=0&&rec.top<vpHeight,bViz=isContained?rec.bottom-wPosition.top>0&&rec.bottom<=vpHeight+wPosition.top:rec.bottom>0&&rec.bottom<=vpHeight,lViz=isContained?rec.left-wPosition.left>=0&&rec.left<vpWidth+wPosition.left:rec.left>=0&&rec.left<vpWidth,rViz=isContained?rec.right-wPosition.left>0&&rec.right<vpWidth+wPosition.left:rec.right>0&&rec.right<=vpWidth,vVisible=partial?tViz||bViz:tViz&&bViz,hVisible=partial?lViz||rViz:lViz&&rViz,vVisible=(rec.top<0&&rec.bottom>vpHeight)?!0:vVisible,hVisible=(rec.left<0&&rec.right>vpWidth)?!0:hVisible;if(direction==='both')
return clientSize&&vVisible&&hVisible;else if(direction==='vertical')
return clientSize&&vVisible;else if(direction==='horizontal')
return clientSize&&hVisible}else{var viewTop=isContained?0:wPosition,viewBottom=viewTop+vpHeight,viewLeft=$c.scrollLeft(),viewRight=viewLeft+vpWidth,position=$t.position(),_top=position.top,_bottom=_top+$t.height(),_left=position.left,_right=_left+$t.width(),compareTop=partial===!0?_bottom:_top,compareBottom=partial===!0?_top:_bottom,compareLeft=partial===!0?_right:_left,compareRight=partial===!0?_left:_right;if(direction==='both')
return!!clientSize&&((compareBottom<=viewBottom)&&(compareTop>=viewTop))&&((compareRight<=viewRight)&&(compareLeft>=viewLeft));else if(direction==='vertical')
return!!clientSize&&((compareBottom<=viewBottom)&&(compareTop>=viewTop));else if(direction==='horizontal')
return!!clientSize&&((compareRight<=viewRight)&&(compareLeft>=viewLeft))}}})(jQuery);if('undefined'==typeof _brayworth_)
var _brayworth_=function(){return(_brayworth_)}
$.extend(_brayworth_,{_brayworth_:!0,logon_retrieve_password:!1,templates:{},bootstrap_version:function(){if('undefined'!=typeof bootstrap){if(!!bootstrap.Alert){if(/4/.test(bootstrap.Alert.VERSION)){return 4}else if(/3/.test(bootstrap.Alert.VERSION)){return 3}}}
return 0},url:function(_url){if('undefined'==typeof _url)
_url='';return('/'+_url)},moment:function(a,b,c,d){var d=moment(a,b,c,d)
return(d)}});_brayworth_.urlwrite=_brayworth_.url;if(typeof _brayworth_=='undefined')
var _brayworth_={};_brayworth_.bootstrapModalPop=function(params){if(/string/.test(typeof params)){var modal=$(this).data('modal');if(/close/i.test(params)){modal.close();return}}
var options={title:'',width:!1,autoOpen:!0,buttons:{},headButtons:{},}
$.extend(options,params);var header=$('<div class="modal-header"><i class="fa fa-times close"></i><h1></h1></div>');var body=$('<div class="modal-body"></div>');body.append(this);var footer=$('<div class="modal-footer text-right"></div>');var modal=$('<div class="modal"></div>');var wrapper=$('<div class="modal-content"></div>');if(options.width)
wrapper.css({'width':'300px'});else wrapper.addClass('modal-content-600');wrapper.append(header).append(body).appendTo(modal);var _el=$(this)
var s=_el.attr('title');$('h1',header).html('').append(s);if(Object.keys(options.buttons).length>0){$.each(options.buttons,function(i,el){var b=$('<button class="button button-raised"></button>')
b.html(i);b.on('click',function(e){el.click.call(modal,e)})
footer.append(b)})
wrapper.append(footer)}
if(Object.keys(options.headButtons).length>0){$.each(options.headButtons,function(i,el){if(!!el.icon)
var b=$('<i class="fa fa-fw pull-right" style="margin-right: 3px; padding-right: 12px; cursor: pointer;"></i>').addClass(el.icon);else var b=$('<button class="button button-raised pull-right"></button>').html(i);if(!!el.title)
b.attr('title',el.title)
b.on('click',function(e){el.click.call(modal,e)})
header.prepend(b)})
header.prepend($('.close',header))}
modal.appendTo('body');$(this).data('modal',modal.modalDialog({afterClose:function(){modal.remove();if(!!options.afterClose&&/function/.test(typeof options.afterClose))
options.afterClose.call(modal)},}))};if(typeof _brayworth_=='undefined')
var _brayworth_={};_brayworth_.browser={}
_brayworth_.browser.isIPhone=navigator.userAgent.toLowerCase().indexOf('iphone')>-1;_brayworth_.browser.isIPad=navigator.userAgent.toLowerCase().indexOf('ipad')>-1;_brayworth_.browser.isChromeOniOS=_brayworth_.browser.isIPhone&&navigator.userAgent.toLowerCase().indexOf('CriOS')>-1;_brayworth_.browser.isMobileDevice=_brayworth_.browser.isIPhone||_brayworth_.browser.isIPad;_brayworth_.hideContext=function(el){var _el=$(el);if(!!_el.data('hide')){if(_el.data('hide')=='hide'){if(_brayworth_.bootstrap_version()>=4){$(el).addClass('d-none')}else{$(el).addClass('hidden')}}else{$(el).remove()}}else{$(el).remove()}}
_brayworth_.hideContexts=function(){$('[data-role="contextmenu"]').each(function(i,el){_brayworth_.hideContext(el)})}
_brayworth_.context=function(){return({root:$('<ul class="menu menu-contextmenu" data-role="contextmenu"></ul>'),items:[],length:0,detachOnHide:!0,create:function(item){var el=$('<li></li>').append(item).appendTo(this.root);this.items.push(el);this.length=this.items.length;return(el)},append:function(item){this.create(item);return(this)},open:function(evt){var css={position:'absolute',top:10,left:$(document).width()-140,}
if(!!evt.pageY)
css.top=Math.max(evt.pageY-10,0);if(!!evt.pageX)
css.left=Math.max(evt.pageX-40,0);if(this.detachOnHide){this.root.css(css).appendTo('body').data('hide','detach')}else{if(this.root.parent().length<1)
this.root.appendTo('body').data('hide','hide');this.root.css(css).removeClass('hidden d-none')}
var offset=this.root.offset();if(offset.left+this.root.width()>$(window).width()){var l=$(window).width()-this.root.width()-5;this.root.css('left',Math.max(l,2));offset=this.root.offset()}
if(offset.top+this.root.height()>($(window).height()+$(window).scrollTop())){var t=($(window).height()+$(window).scrollTop())-this.root.height()-5;this.root.css('top',Math.max(t,$(window).scrollTop()+2));offset=this.root.offset()}
if(offset.left>($(window).width()-(this.root.width()*2)))
this.root.addClass('menu-contextmenu-right');else this.root.removeClass('menu-contextmenu-right');if(offset.top+(this.root.height()*1.2)>($(window).height()+$(window).scrollTop()))
this.root.addClass('menu-contextmenu-low');else this.root.removeClass('menu-contextmenu-low');return(this)},close:function(){if(this.detachOnHide){this.root.remove()}else{this.root.addClass('hidden')}
return(this)},remove:function(){return(this.close())},attachTo:function(parent){var _me=this;$(parent).off('click.removeContexts').on('click.removeContexts',function(evt){if($(evt.target).closest('[data-role="contextmenu"]').length>0){if(/^(a)$/i.test(evt.target.nodeName))
return}
_brayworth_.hideContexts()}).on('contextmenu',function(evt){if($(evt.target).closest('[data-role="contextmenu"]').length)
return;_brayworth_.hideContexts();if(evt.shiftKey)
return;if(/^(input|textarea|img|a|select)$/i.test(evt.target.nodeName)||$(evt.target).closest('a').length>0)
return;if($(evt.target).closest('table').data('nocontextmenu')=='yes')
return;if($(evt.target).hasClass('modal')||$(evt.target).closest('.modal').length>0)
return;if($(evt.target).hasClass('ui-widget-overlay')||$(evt.target).closest('.ui-dialog').length>0)
return;if(typeof window.getSelection!="undefined"){var sel=window.getSelection();if(sel.rangeCount){if(sel.anchorNode.parentNode==evt.target){var frag=sel.getRangeAt(0).cloneContents();var text=frag.textContent;if(text.length>0)
return}}}
evt.preventDefault();_me.open(evt)});return(_me)}})};_brayworth_.fileDragDropContainer=function(){var c=$('<div>&nbsp;</div>');var _c=$('<div class="box__uploading"></div>').appendTo(c);var __c=$('<div class="box__fill text-center">uploading</div>').appendTo(_c);$('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>').appendTo(__c);return(c)};_brayworth_.fileDragDropHandler=function(params){var _el=$(this);var options={url:!1,postData:{},onUpload:function(response){},}
$.extend(options,params);if(!options.url)
throw 'Invalid upload url';var isAdvancedUpload=(function(){var div=document.createElement('div');return(('draggable' in div)||('ondragstart' in div&&'ondrop' in div))&&'FormData' in window&&'FileReader' in window})();if(isAdvancedUpload&&!_el.hasClass('has-advanced-upload')){_el.addClass('has-advanced-upload').on('drag dragstart dragend dragover dragenter dragleave drop',function(e){e.preventDefault();e.stopPropagation()}).on('dragover dragenter',function(){$(this).addClass('is-dragover')}).on('dragleave dragend drop',function(){$(this).removeClass('is-dragover')}).on('drop',function(e){e.preventDefault();var droppedFiles=e.originalEvent.dataTransfer.files;if(droppedFiles){var data=new FormData();for(var o in options.postData)
data.append(o,options.postData[o]);$.each(droppedFiles,function(i,file){data.append('files-'+i,file)});$('.box__fill',_el).css('width','0');_el.addClass('is-uploading');$.ajax({url:options.handler,type:'POST',data:data,dataType:'json',cache:!1,contentType:!1,processData:!1,xhr:function(){var xhr=new window.XMLHttpRequest();xhr.upload.addEventListener("progress",function(e){if(e.lengthComputable)
$('.box__fill',_el).css('width',(e.loaded/e.total*100)+'%')})
return xhr}}).done(function(response){if(response.response=='ack'){$.each(response.data,function(i,j){$('body').growlAjax(j)})}else{$('body').growlAjax(response)}
options.onUpload(response)}).always(function(r){_el.removeClass('is-uploading')}).fail(function(r){console.warn(r);_brayworth_.modal({title:'Upload Error',text:'there was an error uploading the attachments<br />we recommend you reload your browser'})})}})}};(function(){_brayworth_.growlSuccess=function(params){var options={growlClass:'success'}
if(/object/.test(typeof params))
$.extend(options,params);else if(/string/i.test(typeof params))
options.text=params;return(_brayworth_.growl.call(this,options))}
_brayworth_.growlError=function(params){var options={growlClass:'error',timeout:5000}
if(/object/.test(typeof params))
$.extend(options,params);else if(/string/i.test(typeof params))
options.text=params;return(_brayworth_.growl.call(this,options))}
_brayworth_.growlAjax=function(j){var options={growlClass:'error',text:'no description'}
if(!!j.response&&j.response=='ack')
options.growlClass='success';if(!!j.description)
options.text=j.description;if(options.growlClass=='error')
options.timeout=5000;if(!!j.timeout)
options.timeout=j.timeout;return(_brayworth_.growl.call(this,options))}
var growlers=[];_brayworth_.growl=function(params){var host=(this==_brayworth_?$('body'):this)
if('string'==typeof this){host=$(host)}else if(this instanceof String){host=$(host.valueOf())}else if('object'==typeof this&&!!this.xhr){host=$('body')}else if(!(this instanceof jQuery)){host=$(host)}
return new Promise(function(resolve,reject){var options={top:60,right:20,text:'',title:'',timeout:2000,growlClass:'information',}
if('object'==typeof params)
$.extend(options,params);else if('string'==typeof params)
options.text=params;if(options.title==''&&options.text==''){if(!!params.response)
options.growlClass=(params.response=='ack'?'success':'error');if(!!params.description)
options.text=params.description;if(!!params.timeout)
options.timeout=params.timeout;else if(options.growlClass=='error')
options.timeout=5000}
if(options.title==''&&options.text=='')
return;var growler=$('<div class="growler" />');var growlerIndex=-1
$.each(growlers,function(i,e){if(!e){growlerIndex=i;growlers[growlerIndex]=growler;return(!1)}});if(growlerIndex<0){growlerIndex=growlers.length;growlers[growlerIndex]=growler}
if(host[0].tagName=='BODY'||host.css('position')!='static'){options.top*=growlerIndex}else{try{var offset=host.offset();options.top=offset.top-20;options.right=Math.min($(window).width(),offset.left+host.width()+20)}catch(e){console.warn(host,e)}}
options.top=Math.max(options.top,$(window).scrollTop());var title=$('<h3 />');var content=$('<div />');if(options.title!='')
title.html(options.title).appendTo(growler);else content.css('padding-top','5px');if(options.text!='')
content.html(options.text).appendTo(growler);growler.css({'position':'absolute','top':options.top,'right':options.right}).addClass(options.growlClass).appendTo(host);setTimeout(function(){growlers[growlerIndex]=!1;growler.remove();resolve()},options.timeout)})}})();_brayworth_.ScrollTo=function(el){var _el=(el instanceof jQuery?el:$(el));var t=_el.offset().top;var nav=$('body>nav');if(nav.length){t-=(nav.height())}else{var hdr=$('body>header');if(hdr.length)
t-=(hdr.height())}
t=Math.max(20,t);$('html, body').animate({scrollTop:t},1000)}
_brayworth_.hashScroll=function(){$('a[href*="#"]:not([href="#"] , .carousel-control, .ui-tabs-anchor)').on('click',function(){if(location.pathname.replace(/^\//,'')==this.pathname.replace(/^\//,'')&&location.hostname==this.hostname){var target=$(this.hash);target=target.length?target:$('[name='+this.hash.slice(1)+']');if(target.length){if(/nav/i.test(target.prop('tagName')))
return;_brayworth_.ScrollTo(target);return!1}}})};var hourglass=_brayworth_.hourglass={h:!1,on:function(){if(!this.h){this.h=$('<div class="modal" />').append('<i class="fa fa-spinner fa-pulse fa-4x" style="position: fixed; top: 50%; left: 50%" />').appendTo('body').css('display','block')}
return(this)},off:function(){if(this.h)
this.h.remove();this.h=!1;return(this)}};if(typeof _brayworth_=='undefined')
var _brayworth_={};_brayworth_.initDatePickers=function(parent){if($.fn.datepicker){if(!parent)
parent='body';$('.datepicker',parent).each(function(i,el){var bootstrap=(typeof $().scrollspy=='function');var df=$(el).data('dateformat');if(df==undefined){if(bootstrap)
df='yyyy-mm-dd';else if(jQuery.ui)
df='yy-mm-dd'}
if(bootstrap)
$(el).datepicker({format:df});else if(jQuery.ui)
$(el).datepicker({dateFormat:df})})}};_brayworth_.InitHRefs=function(){$('[data-href]').each(function(i,el){$(el).css({'cursor':'pointer'}).off('click').on('click',function(e){if(/^(a)$/i.test(e.target.nodeName))
return;e.stopPropagation();e.preventDefault();if($(e.target).closest('[data-role="contextmenu"]').length>0)
_brayworth_.hideContext($(e.target).closest('[data-role="contextmenu"]')[0]);var target=$(this).data('target');if(target==''||target==undefined)
window.location.href=$(this).data('href');else window.open($(this).data('href'),target)})})};_brayworth_.lazyImageLoader=function(){var imgStack=[];$('div[data-delayedimg="true"]').each(function(i,el){var _=$(el);if(_.visible(!0))
_.css({'background-image':'url("'+_.data('src')+'")'}).data('delayedimg',!1);else imgStack.push(_)})
if(imgStack.length>0){$(document).on('scroll',function(e){var unProcessed=0;$.each(imgStack,function(i,el){var _=$(el);if(_.data('delayedimg')){if(_.visible(!0)){_.css({'background-image':'url("'+_.data('src')+'")'}).data('delayedimg',!1)}else{unProcessed ++}}})
if(unProcessed<1){$(document).off('scroll')}})}};_brayworth_.logonModal=function(){var flds={user:$('<input type="text" class="form-control" placeholder="username" />'),pass:$('<input type="password" class="form-control" placeholder="password" />'),}
var dlg=$('<div class="container" />');var form=$('<form class="form" />').appendTo(dlg);$('<div class="row py-1" />').append($('<div class="col" />').append(flds.user)).appendTo(form);$('<div class="row py-1" />').append($('<div class="col" />').append(flds.pass)).appendTo(form);function submitter(){var u=flds.user.val();var p=flds.pass.val();if(u.trim()==''){$('body').growlError('empty user');flds.user.focus();return}
if(p.trim()==''){$('body').growlError('empty pass');flds.pass.focus();return}
modal.modal('close');$.ajax({type:'post',url:_brayworth_.urlwrite(),data:{action:'-system-logon-',u:u,p:p,}}).done(function(d){$('body').growlAjax(d);if(!!d.response&&d.response=='ack')
window.location.reload();else setTimeout(_brayworth_.logonModal,2000)})}
function retrievePassword(){var u=flds.user.val();if(u.trim()==''){$('body').growlError('empty user');flds.user.focus();return}
$.ajax({type:'post',url:_brayworth_.urlwrite(),data:{action:'-send-password-',u:u,}}).done(function(d){$('body').growlAjax(d);if(!!d.response&&d.response=='ack'){_brayworth_.modal({width:300,title:d.description,text:d.message,buttons:{OK:function(e){$(this).modal('close');flds.user.focus()}}})}})}
form.on('submit',function(){submitter();return!1}).append('<input type="submit" style="display: none;" />');var buttons={};if(_brayworth_.logon_retrieve_password)
buttons['Send Password']=retrievePassword;buttons.logon=submitter;var modal=_brayworth_.modal({width:300,title:'logon',text:dlg,buttons:buttons})};_brayworth_.modal=function(params){jQuery.fn.modal=_brayworth_.modal;if('string'==typeof params){var _m=$(this).data('modal');if('close'==params)
_m.close();return}
var options={title:'',width:!1,height:!1,mobile:_brayworth_.browser.isMobileDevice,fullScreen:_brayworth_.browser.isMobileDevice,className:'',autoOpen:!0,buttons:{},headButtons:{},closeIcon:'fa-times',onOpen:function(){},}
$.extend(options,params);var t=_brayworth_.templates.modal();if(options.className!='')
t.get().addClass(options.className);t.get('.close').addClass(options.closeIcon);if(!!options.width)
t.get('.modal-content').width(options.width);else t.get('.modal-content').addClass(_brayworth_.templates.modalDefaultClass);var content=(!!options.text?options.text:'');if('undefined'!=typeof this){if(!this._brayworth_){var content=(this instanceof jQuery?this:$(this));if(options.title==''&&('string'==typeof content.attr('title')))
options.title=content.attr('title')}}
t.html('H1','').append(options.title);t.append(content);if(Object.keys(options.buttons).length>0){$.each(options.buttons,function(i,el){var j={text:i,click:function(e){}}
if('function'==typeof el)
j.click=el;else $.extend(j,el);$('<button />').addClass(_brayworth_.templates.buttonCSS).html(j.text).on('click',function(e){j.click.call(t.get(),e)}).appendTo(t.footer())})}
if(Object.keys(options.headButtons).length>0){$.each(options.headButtons,function(i,el){var j={text:i,title:!1,icon:!1,click:function(e){},}
if('function'==typeof el)
j.click=el;else $.extend(j,el);if(!!j.icon){var b=$('<div class="pull-right pointer pt-1 px-2" />').append($('<i class="fa m-0" style="cursor: pointer;" />').addClass(j.icon))}else{var b=$('<button class="pull-right" />').html(j.text).addClass(_brayworth_.templates.buttonCSS)}
if(!!j.title)
b.attr('title',j.title)
b.on('click',function(e){j.click.call(t.get(),e)})
t.header.prepend(b)})
t.header.prepend($('.close',t.header))}
var previousElement=document.activeElement;var bodyElements=[];if(options.fullScreen){$('body > *').each(function(i,el){var _el=$(el);if(!_el.hasClass('hidden')){_el.addClass('hidden');bodyElements.push(_el)}})
t.get('.modal-content').css({'width':'auto','margin':0})}else{if(!!options.height){t.get('.modal-body').height(options.height).css({'overflow-y':'auto','overflow-x':'hidden'})}}
t.appendTo('body');var _modal=_brayworth_.modalDialog.call(t.get(),{mobile:options.mobile,onOpen:options.onOpen,afterClose:function(){t.get().remove();if(!!options.afterClose&&'function'==typeof options.afterClose)
options.afterClose.call(t.modal);$.each(bodyElements,function(i,el){$(el).removeClass('hidden')})
previousElement.focus()},});_modal.load=function(url){return new Promise(function(resolve,reject){var d=$('<div class="container-fluid" />');t.append(d);d.load(url,function(){resolve(_modal)})})}
t.data('modal',_modal);if('undefined'!=typeof this&&!this._brayworth_){if(this instanceof jQuery)
this.data('modal',_modal);else $(this).data('modal',_modal)}
return(t.data('modal'))}
_brayworth_.templates.buttonCSS='btn btn-default';_brayworth_.templates.modalDefaultClass='';_brayworth_.templates.modal=function(){var _=templation.template('modal');_.header=_.get('.modal-header');_.body=_.get('.modal-body');_.append=function(p){this.body.append(p);return(this)}
_.footer=function(){if(!this._footer){this._footer=$('<div class="modal-footer text-right" />');this.get('.modal-content').append(this._footer)}
return(this._footer)};return(_)}
$.fn.modalDialog=_brayworth_.modalDialog=function(_options){if(/string/.test(typeof(_options))){if(_options=='close'){var modal=this.data('modal');modal.close();return(modal)}}
var modal=this;var options={mobile:_brayworth_.browser.isMobileDevice,beforeClose:function(){},afterClose:function(){},onEnter:function(){},onOpen:function(){},};$.extend(options,_options);var close=$('.close',this);modal.close=function(){options.beforeClose.call(modal);modal.css('display','none');options.afterClose.call(modal);modal=!1;$(document).unbind('keyup.modal');$(document).unbind('keypress.modal')}
if(options.mobile)
modal.addClass('modal-mobile');modal.css('display','block').data('modal',modal);var _AF=$('[autofocus]',modal);if(_AF.length>0){_AF.first().focus()}else{_AF=$('textarea, input, button, a',modal);if(_AF.length>0)
_AF.first().focus()}
$(document).on('keyup.modal',function(e){if(e.keyCode==27){if(modal)
modal.close()}}).on('keypress.modal',function(e){if(e.keyCode==13)
options.onEnter.call(modal,e)})
close.off('click').css({cursor:'pointer'}).on('click',function(e){modal.close()});options.onOpen.call(modal);return(modal)}
_brayworth_.post=function(params){var options={url:_brayworth_.urlwrite(),type:'POST',data:{},growl:function(d){$('body').growlAjax(d)},};$.extend(options,params);return $.ajax(options)}
_brayworth_.swipeOff=function(){$(this).off('mousedown touchstart').off('mouseup touchend')};_brayworth_.swipeOn=function(params){var options={left:function(){},right:function(){},up:function(){},down:function(){},}
$.extend(options,params);var down=!1;var touchEvent=function(e){var _touchEvent=function(x,y){return({'x':x,'y':y})}
var evt=e.originalEvent;try{if('undefined'!==typeof evt.pageX){return(_touchEvent(evt.pageX,evt.pageY))}else if('undefined'!==typeof evt.touches){if(evt.touches.length>0)
return(_touchEvent(evt.touches[0].pageX,evt.touches[0].pageY));else return(_touchEvent(evt.changedTouches[0].pageX,evt.changedTouches[0].pageY))}}catch(e){console.warn(e)}
return(_touchEvent(0,0))}
var swipeEvent=function(down,up){var j={'direction':'',x:up.x-down.x,y:up.y-down.y}
if(j.x>70)
j.direction='right'
else if(j.x<-70)
j.direction='left'
return(j)}
$(this).on('mousedown touchstart',function(e){if(/^(input|textarea|img|a|select)$/i.test(e.target.nodeName))
return;down=touchEvent(e)}).on('mouseup touchend',function(e){if(down){var sEvt=swipeEvent(down,touchEvent(e));down=!1;if(sEvt.direction=='left')
options.left();else if(sEvt.direction=='right')
options.right()}})};(function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}
String.prototype.ltrim=function(){return this.replace(/^\s+/,"")}
String.prototype.rtrim=function(){return this.replace(/\s+$/,"")}
String.prototype.pad=function(len,padChar){if(padChar==undefined){padChar=" "}
if(isNaN(len)){len=this.length}
var res=this;while(res.length<len){res=res.concat(padChar)}
return(res)};String.prototype.padLeft=function(len,padChar){if(padChar==undefined){padChar=" "}
if(isNaN(len)){len=this.length}
var res=this;if(res.length>len){var iStart=(res.length-len);res=res.substring(iStart)}else{while(res.length<len){res=padChar.concat(res)}}
return(res)};String.prototype.format=function(){var args=arguments;return this.replace(/\{\{|\}\}|\{(\d+)\}/g,function(m,n){if(m=="{{"){return"{"}
if(m=="}}"){return"}"}
return args[n]})};String.prototype.toCapitalCase=function(){var re=/\s/;var words=this.split(re);re=/(\S)(\S+)/;var reI=/^[a-zA-Z]'[a-zA-Z]+$/;for(var i=words.length-1;i>=0;i--){if(words[i]!="&"){if(words[i].length>3&&reI.test(words[i])){parts=words[i].split(/'/);words[i]=parts[0].toUpperCase()+"'"+parts[1].substring(0,1).toUpperCase()+parts[1].substring(1).toLowerCase()}else if(re.test(words[i])){words[i]=RegExp.$1.toUpperCase()+RegExp.$2.toLowerCase()}}}
return words.join(' ')}
String.prototype.AsLocalPhone=function(){var p=this;var ns=this.replace(/\s+|\(|\)|\-/g,"");if(ns.length==8){if(!ns.substring(0,1)=='0')
ns=fallback_area_code+ns}
if(ns.length==10){re=/(\S\S)(\S\S\S\S)(\S+)/;if(re.test(ns)){if(!!useCompactPhoneFormat)
ns=RegExp.$1+" "+RegExp.$2+""+RegExp.$3;else ns=RegExp.$1+" "+RegExp.$2+" "+RegExp.$3;return(ns)}}else if(/^0011/.test(ns)){re=/(\S\S\S\S)(\S\S)(\S+)/;if(re.test(ns)){ns=RegExp.$1+" "+RegExp.$2+" "+RegExp.$3;return(ns)}}
return(p)};String.prototype.IsMobilePhone=function(){var p=this;var ns=this.replace(/\s+|\(|\)|\-/g,"");if(ns.length==10)
return(!0);else if(/^(\+|0011)/.test(ns)){re=/(\S\S\S\S)(\S+)/;if(re.test(ns))
return(!0)}
return(!1)};String.prototype.AsMobilePhone=function(){var p=this;var ns=this.replace(/\s+|\(|\)|\-/g,"");if(ns.length==10){re=/(\S\S\S\S)(\S\S\S)(\S+)/;if(re.test(ns)){if(!!useCompactPhoneFormat)
ns=RegExp.$1+' '+RegExp.$2+''+RegExp.$3;else ns=RegExp.$1+' '+RegExp.$2+' '+RegExp.$3;return(ns)}}else if(/^(\+|0011)/.test(ns)){re=/(\S\S\S\S)(\S+)/;if(re.test(ns)){ns=RegExp.$1+' '+RegExp.$2;return(ns)}}
return(p)};String.prototype.isEmail=function(){if(this.length<3)
return(!1);var e=this;if(/</.test(e)&&/>$/.test(e))
e=e.replace(/^.*</,'').replace(/>$/,'');var rex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(/.con$/i.test(e.toLowerCase()))
return(!1);return rex.test(e.toLowerCase())}
Number.prototype.formatComma=function(x){return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
Number.prototype.formatCurrency=function(){var parts=this.toString().split(".");if(parts.length<2)
parts.push('00');else if(parts[1].length<1)
parts[1]+='00';else if(parts[1].length<2)
parts[1]+='0';parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return parts.join(".")}})();_brayworth_.table={}
_brayworth_.table.sortOn=function(table,key,sorttype,order){var debug=!1;var tbody=$('tbody',table);if(!tbody)tbody=table;if('undefined'==typeof order)
order=(tbody.data('order')=="desc"?"asc":"desc");tbody.data('order',order);if(!sorttype)
sorttype='string';var warn=!0;var items=tbody.children('tr');if(debug)console.log(key,sorttype,order,items.length);items.sort(function sortItem(a,b){var ae=$(a).data(key);var be=$(b).data(key);if(/undefined/.test(typeof ae)||/undefined/.test(typeof ae)){ae=$(a).data('key-'+key);be=$(b).data('key-'+key);if(warn)
console.warn('table sorting is not jQuery3 compatible');warn=!1}
if(debug)console.log(key,ae,be,sorttype,order);if(sorttype=="numeric"){if('undefined'==typeof ae)
ae=0;if('undefined'==typeof be)
be=0;return(Number(ae)-Number(be))}else{if('undefined'==typeof ae)
ae='';if('undefined'==typeof be)
be='';return(ae.toUpperCase().localeCompare(be.toUpperCase()))}});$.each(items,function(i,e){(order=="desc"?tbody.prepend(e):tbody.append(e))});var lines=$('tr>[role="line-number"]',tbody);if(lines.length>0){lines.each(function(i,e){$(e).html(i+1)})}else{var lines=$('tr>td>[role="line-number"]',tbody);if(lines.length>0){lines.each(function(i,e){$(e).html(i+1)})}}}
_brayworth_.table.sort=function(e){if('undefined'!=typeof e&&!!e.target)e.stopPropagation();_brayworth_.hideContexts();var table=$(this).closest('table');if(!table)return;var key=$(this).data("key");if(!key)return;var sorttype=$(this).data("sorttype");_brayworth_.table.sortOn(table,key,sorttype)};_brayworth_.Vue=function(params){var options={filters:{}};var filters={capitalize:function(value){if(!value)return''
return value.toCapitalCase()}};$.extend(options,params);$.extend(options.filters,filters);return new Promise(function(resolve,reject){if('undefined'===typeof Vue){_cms_.getScript(_brayworth_.urlwrite('js/vue.min.js')).then(function(d){resolve(new Vue(options))})}else{resolve(new Vue(options))}})};(function(){var cache={};_brayworth_.Vue.block=function(params){return(new Promise(function(resolve,reject){var options={block:'',url:_brayworth_.urlwrite(),}
$.extend(options,params);if(!options.block){reject('no template')}else if('string'!=typeof options.block){reject('template must be a string')}else if(options.block in cache){resolve(cache[options.block])}else{$.ajax({type:'post',url:options.url,data:{action:'get-vue-block',block:options.block,}}).done(function(d){cache[options.block]=d;resolve(d)})}}))}})();(function(){if(!1){if('serviceWorker' in navigator){if(/^https:/.test(window.location.href)){navigator.serviceWorker.register('/js/service-worker.js').then(function(){})}}}})();$(document).ready(function(){_brayworth_.InitHRefs();_brayworth_.initDatePickers();$('[data-role="back-button"]').each(function(i,el){$(el).css('cursor','pointer').on('click',function(evt){evt.stopPropagation();evt.preventDefault();window.history.back()})})
$('[data-role="visibility-toggle"]').each(function(i,el){var _el=$(el);var target=_el.data('target');var oT=$('#'+target);if(oT){_el.css('cursor','pointer').on('click',function(evt){evt.stopPropagation();evt.preventDefault();oT.toggle()})}})
$('[role="print-page"]').each(function(i,el){$(el).on('click',function(e){e.preventDefault();window.print()})})});(function($){$.fn.serializeFormJSON=function(){var o={};var a=this.serializeArray();$.each(a,function(){if(o[this.name]){if(!o[this.name].push)
o[this.name]=[o[this.name]];o[this.name].push(this.value||'')}else o[this.name]=this.value||''});return o};$.fn.growlSuccess=_brayworth_.growlSuccess;$.fn.growlError=_brayworth_.growlError;$.fn.growlAjax=_brayworth_.growlAjax;$.fn.growl=_brayworth_.growl;$.fn.swipeOn=_brayworth_.swipeOn;$.fn.swipeOff=_brayworth_.swipeOff})(jQuery);var templation={urlwrite:function(_url){if('undefined'==typeof _url)
_url='';return('/'+_url)}};(function(){var cache={container:'<div class="container" />',row:'<div class="row" />',form:'<form />',table:'<table><thead></thead><tbody /><tfoot /></table>',tr:'<tr />',modal:'<div class="modal"><div class="modal-content" role="dialog" aria-labelledby="modal-header-title"><div class="modal-header"><i class="fa fa-times close" /><h1 id="modal-header-title" /></div><div class="modal-body" /></div></div>',};function _t(src){var _={src:src,_element:!1,get:function(k){if('undefined'==typeof k)
return(this._element);else return $(k,this._element)},data:function(k,v){if('undefined'==typeof v)
return(this._element.data(k));else return(this._element.data(k,v))},html:function(k,v){var e=this.get(k);if('undefined'!=typeof(v))
return(e.html(v));else return(e.html())},val:function(k,v){var e=this.get(k);if('undefined'!=typeof(v))
return(e.val(v));else return(e.val())},append:function(p){this._element.append(p);return(this)},appendTo:function(p){this._element.appendTo(p);return(this)},prependTo:function(p){this._element.prependTo(p);return(this)},remove:function(p){this._element.remove();return(this)},reset:function(){this._element=$(this.src);return(this)}}
return(_.reset())}
templation.template=function(name){if(name in cache)
return(_t(cache[name]));else throw 'template not in cache'}
templation.loadHTML=function(key,fragment){cache[key]=fragment;return(_t(fragment))}
templation.load=function(params){return(new Promise(function(resolve,reject){var options={type:'post',template:'',url:templation.urlwrite(),}
$.extend(options,params);if(!options.template){reject('no template')}else if('string'!=typeof options.template){reject('template must be a string')}else{if(options.template in cache){resolve(_t(cache[options.template]))}else{$.ajax({type:options.type,url:options.url,data:{action:'get-template',template:options.template,}}).done(function(d){cache[options.template]=d;if(d==''){console.warn('templation:\n did you read the notes about the home controller\n > the home Controller must return the template upon\n   receiving the get-template request')}
resolve(_t(d))})}}}))}})();(function(factory){var registeredInModuleLoader=!1;if(typeof define==='function'&&define.amd){define(factory);registeredInModuleLoader=!0}
if(typeof exports==='object'){module.exports=factory();registeredInModuleLoader=!0}
if(!registeredInModuleLoader){var OldCookies=window.Cookies;var api=window.Cookies=factory();api.noConflict=function(){window.Cookies=OldCookies;return api}}}(function(){function extend(){var i=0;var result={};for(;i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes){result[key]=attributes[key]}}
return result}
function init(converter){function api(key,value,attributes){var result;if(typeof document==='undefined'){return}
if(arguments.length>1){attributes=extend({path:'/'},api.defaults,attributes);if(typeof attributes.expires==='number'){var expires=new Date();expires.setMilliseconds(expires.getMilliseconds()+attributes.expires*864e+5);attributes.expires=expires}
attributes.expires=attributes.expires?attributes.expires.toUTCString():'';try{result=JSON.stringify(value);if(/^[\{\[]/.test(result)){value=result}}catch(e){}
if(!converter.write){value=encodeURIComponent(String(value)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)}else{value=converter.write(value,key)}
key=encodeURIComponent(String(key));key=key.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);key=key.replace(/[\(\)]/g,escape);var stringifiedAttributes='';for(var attributeName in attributes){if(!attributes[attributeName]){continue}
stringifiedAttributes+='; '+attributeName;if(attributes[attributeName]===!0){continue}
stringifiedAttributes+='='+attributes[attributeName]}
return(document.cookie=key+'='+value+stringifiedAttributes)}
if(!key){result={}}
var cookies=document.cookie?document.cookie.split('; '):[];var rdecode=/(%[0-9A-Z]{2})+/g;var i=0;for(;i<cookies.length;i++){var parts=cookies[i].split('=');var cookie=parts.slice(1).join('=');if(cookie.charAt(0)==='"'){cookie=cookie.slice(1,-1)}
try{var name=parts[0].replace(rdecode,decodeURIComponent);cookie=converter.read?converter.read(cookie,name):converter(cookie,name)||cookie.replace(rdecode,decodeURIComponent);if(this.json){try{cookie=JSON.parse(cookie)}catch(e){}}
if(key===name){result=cookie;break}
if(!key){result[name]=cookie}}catch(e){}}
return result}
api.set=api;api.get=function(key){return api.call(api,key)};api.getJSON=function(){return api.apply({json:!0},[].slice.call(arguments))};api.defaults={};api.remove=function(key,attributes){api(key,'',extend(attributes,{expires:-1}))};api.withConverter=init;return api}
return init(function(){})}));(function(root,factory){if(typeof define==="function"&&define.amd){define("bloodhound",["jquery"],function(a0){return root.Bloodhound=factory(a0)})}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.Bloodhound=factory(jQuery)}})(this,function($){var _=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return typeof obj==="string"},isNumber:function(obj){return typeof obj==="number"},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return typeof obj==="undefined"},isElement:function(obj){return!!(obj&&obj.nodeType===1)},isJQuery:function(obj){return obj instanceof $},toStr:function toStr(s){return _.isUndefined(s)||s===null?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,reverseArgs);function reverseArgs(index,value){return cb(value,index)}},map:$.map,filter:$.grep,every:function(obj,test){var result=!0;if(!obj){return result}
$.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj))){return!1}});return!!result},some:function(obj,test){var result=!1;if(!obj){return result}
$.each(obj,function(key,val){if(result=test.call(null,val,key,obj)){return!1}});return!!result},mixin:$.extend,identity:function(x){return x},clone:function(obj){return $.extend(!0,{},obj)},getIdGenerator:function(){var counter=0;return function(){return counter++}},templatify:function templatify(obj){return $.isFunction(obj)?obj:template;function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}
return result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;previous=0;later=function(){previous=new Date();timeout=null;result=func.apply(context,args)};return function(){var now=new Date(),remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}
return result}},stringify:function(val){return _.isString(val)?val:JSON.stringify(val)},noop:function(){}}}();var VERSION="0.11.1";var tokenizers=function(){"use strict";return{nonword:nonword,whitespace:whitespace,obj:{nonword:getObjTokenizer(nonword),whitespace:getObjTokenizer(whitespace)}};function whitespace(str){str=_.toStr(str);return str?str.split(/\s+/):[]}
function nonword(str){str=_.toStr(str);return str?str.split(/\W+/):[]}
function getObjTokenizer(tokenizer){return function setKey(keys){keys=_.isArray(keys)?keys:[].slice.call(arguments,0);return function tokenize(o){var tokens=[];_.each(keys,function(k){tokens=tokens.concat(tokenizer(_.toStr(o[k])))});return tokens}}}}();var LruCache=function(){"use strict";function LruCache(maxSize){this.maxSize=_.isNumber(maxSize)?maxSize:100;this.reset();if(this.maxSize<=0){this.set=this.get=$.noop}}
_.mixin(LruCache.prototype,{set:function set(key,val){var tailItem=this.list.tail,node;if(this.size>=this.maxSize){this.list.remove(tailItem);delete this.hash[tailItem.key];this.size--}
if(node=this.hash[key]){node.val=val;this.list.moveToFront(node)}else{node=new Node(key,val);this.list.add(node);this.hash[key]=node;this.size++}},get:function get(key){var node=this.hash[key];if(node){this.list.moveToFront(node);return node.val}},reset:function reset(){this.size=0;this.hash={};this.list=new List()}});function List(){this.head=this.tail=null}
_.mixin(List.prototype,{add:function add(node){if(this.head){node.next=this.head;this.head.prev=node}
this.head=node;this.tail=this.tail||node},remove:function remove(node){node.prev?node.prev.next=node.next:this.head=node.next;node.next?node.next.prev=node.prev:this.tail=node.prev},moveToFront:function(node){this.remove(node);this.add(node)}});function Node(key,val){this.key=key;this.val=val;this.prev=this.next=null}
return LruCache}();var PersistentStorage=function(){"use strict";var LOCAL_STORAGE;try{LOCAL_STORAGE=window.localStorage;LOCAL_STORAGE.setItem("~~~","!");LOCAL_STORAGE.removeItem("~~~")}catch(err){LOCAL_STORAGE=null}
function PersistentStorage(namespace,override){this.prefix=["__",namespace,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+_.escapeRegExChars(this.prefix));this.ls=override||LOCAL_STORAGE;!this.ls&&this._noop()}
_.mixin(PersistentStorage.prototype,{_prefix:function(key){return this.prefix+key},_ttlKey:function(key){return this._prefix(key)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=_.noop},_safeSet:function(key,val){try{this.ls.setItem(key,val)}catch(err){if(err.name==="QuotaExceededError"){this.clear();this._noop()}}},get:function(key){if(this.isExpired(key)){this.remove(key)}
return decode(this.ls.getItem(this._prefix(key)))},set:function(key,val,ttl){if(_.isNumber(ttl)){this._safeSet(this._ttlKey(key),encode(now()+ttl))}else{this.ls.removeItem(this._ttlKey(key))}
return this._safeSet(this._prefix(key),encode(val))},remove:function(key){this.ls.removeItem(this._ttlKey(key));this.ls.removeItem(this._prefix(key));return this},clear:function(){var i,keys=gatherMatchingKeys(this.keyMatcher);for(i=keys.length;i--;){this.remove(keys[i])}
return this},isExpired:function(key){var ttl=decode(this.ls.getItem(this._ttlKey(key)));return _.isNumber(ttl)&&now()>ttl?!0:!1}});return PersistentStorage;function now(){return new Date().getTime()}
function encode(val){return JSON.stringify(_.isUndefined(val)?null:val)}
function decode(val){return $.parseJSON(val)}
function gatherMatchingKeys(keyMatcher){var i,key,keys=[],len=LOCAL_STORAGE.length;for(i=0;i<len;i++){if((key=LOCAL_STORAGE.key(i)).match(keyMatcher)){keys.push(key.replace(keyMatcher,""))}}
return keys}}();var Transport=function(){"use strict";var pendingRequestsCount=0,pendingRequests={},maxPendingRequests=6,sharedCache=new LruCache(10);function Transport(o){o=o||{};this.cancelled=!1;this.lastReq=null;this._send=o.transport;this._get=o.limiter?o.limiter(this._get):this._get;this._cache=o.cache===!1?new LruCache(0):sharedCache}
Transport.setMaxPendingRequests=function setMaxPendingRequests(num){maxPendingRequests=num};Transport.resetCache=function resetCache(){sharedCache.reset()};_.mixin(Transport.prototype,{_fingerprint:function fingerprint(o){o=o||{};return o.url+o.type+$.param(o.data||{})},_get:function(o,cb){var that=this,fingerprint,jqXhr;fingerprint=this._fingerprint(o);if(this.cancelled||fingerprint!==this.lastReq){return}
if(jqXhr=pendingRequests[fingerprint]){jqXhr.done(done).fail(fail)}else if(pendingRequestsCount<maxPendingRequests){pendingRequestsCount++;pendingRequests[fingerprint]=this._send(o).done(done).fail(fail).always(always)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}
function done(resp){cb(null,resp);that._cache.set(fingerprint,resp)}
function fail(){cb(!0)}
function always(){pendingRequestsCount--;delete pendingRequests[fingerprint];if(that.onDeckRequestArgs){that._get.apply(that,that.onDeckRequestArgs);that.onDeckRequestArgs=null}}},get:function(o,cb){var resp,fingerprint;cb=cb||$.noop;o=_.isString(o)?{url:o}:o||{};fingerprint=this._fingerprint(o);this.cancelled=!1;this.lastReq=fingerprint;if(resp=this._cache.get(fingerprint)){cb(null,resp)}else{this._get(o,cb)}},cancel:function(){this.cancelled=!0}});return Transport}();var SearchIndex=window.SearchIndex=function(){"use strict";var CHILDREN="c",IDS="i";function SearchIndex(o){o=o||{};if(!o.datumTokenizer||!o.queryTokenizer){$.error("datumTokenizer and queryTokenizer are both required")}
this.identify=o.identify||_.stringify;this.datumTokenizer=o.datumTokenizer;this.queryTokenizer=o.queryTokenizer;this.reset()}
_.mixin(SearchIndex.prototype,{bootstrap:function bootstrap(o){this.datums=o.datums;this.trie=o.trie},add:function(data){var that=this;data=_.isArray(data)?data:[data];_.each(data,function(datum){var id,tokens;that.datums[id=that.identify(datum)]=datum;tokens=normalizeTokens(that.datumTokenizer(datum));_.each(tokens,function(token){var node,chars,ch;node=that.trie;chars=token.split("");while(ch=chars.shift()){node=node[CHILDREN][ch]||(node[CHILDREN][ch]=newNode());node[IDS].push(id)}})})},get:function get(ids){var that=this;return _.map(ids,function(id){return that.datums[id]})},search:function search(query){var that=this,tokens,matches;tokens=normalizeTokens(this.queryTokenizer(query));_.each(tokens,function(token){var node,chars,ch,ids;if(matches&&matches.length===0){return!1}
node=that.trie;chars=token.split("");while(node&&(ch=chars.shift())){node=node[CHILDREN][ch]}
if(node&&chars.length===0){ids=node[IDS].slice(0);matches=matches?getIntersection(matches,ids):ids}else{matches=[];return!1}});return matches?_.map(unique(matches),function(id){return that.datums[id]}):[]},all:function all(){var values=[];for(var key in this.datums){values.push(this.datums[key])}
return values},reset:function reset(){this.datums={};this.trie=newNode()},serialize:function serialize(){return{datums:this.datums,trie:this.trie}}});return SearchIndex;function normalizeTokens(tokens){tokens=_.filter(tokens,function(token){return!!token});tokens=_.map(tokens,function(token){return token.toLowerCase()});return tokens}
function newNode(){var node={};node[IDS]=[];node[CHILDREN]={};return node}
function unique(array){var seen={},uniques=[];for(var i=0,len=array.length;i<len;i++){if(!seen[array[i]]){seen[array[i]]=!0;uniques.push(array[i])}}
return uniques}
function getIntersection(arrayA,arrayB){var ai=0,bi=0,intersection=[];arrayA=arrayA.sort();arrayB=arrayB.sort();var lenArrayA=arrayA.length,lenArrayB=arrayB.length;while(ai<lenArrayA&&bi<lenArrayB){if(arrayA[ai]<arrayB[bi]){ai++}else if(arrayA[ai]>arrayB[bi]){bi++}else{intersection.push(arrayA[ai]);ai++;bi++}}
return intersection}}();var Prefetch=function(){"use strict";var keys;keys={data:"data",protocol:"protocol",thumbprint:"thumbprint"};function Prefetch(o){this.url=o.url;this.ttl=o.ttl;this.cache=o.cache;this.prepare=o.prepare;this.transform=o.transform;this.transport=o.transport;this.thumbprint=o.thumbprint;this.storage=new PersistentStorage(o.cacheKey)}
_.mixin(Prefetch.prototype,{_settings:function settings(){return{url:this.url,type:"GET",dataType:"json"}},store:function store(data){if(!this.cache){return}
this.storage.set(keys.data,data,this.ttl);this.storage.set(keys.protocol,location.protocol,this.ttl);this.storage.set(keys.thumbprint,this.thumbprint,this.ttl)},fromCache:function fromCache(){var stored={},isExpired;if(!this.cache){return null}
stored.data=this.storage.get(keys.data);stored.protocol=this.storage.get(keys.protocol);stored.thumbprint=this.storage.get(keys.thumbprint);isExpired=stored.thumbprint!==this.thumbprint||stored.protocol!==location.protocol;return stored.data&&!isExpired?stored.data:null},fromNetwork:function(cb){var that=this,settings;if(!cb){return}
settings=this.prepare(this._settings());this.transport(settings).fail(onError).done(onResponse);function onError(){cb(!0)}
function onResponse(resp){cb(null,that.transform(resp))}},clear:function clear(){this.storage.clear();return this}});return Prefetch}();var Remote=function(){"use strict";function Remote(o){this.url=o.url;this.prepare=o.prepare;this.transform=o.transform;this.transport=new Transport({cache:o.cache,limiter:o.limiter,transport:o.transport})}
_.mixin(Remote.prototype,{_settings:function settings(){return{url:this.url,type:"GET",dataType:"json"}},get:function get(query,cb){var that=this,settings;if(!cb){return}
query=query||"";settings=this.prepare(query,this._settings());return this.transport.get(settings,onResponse);function onResponse(err,resp){err?cb([]):cb(that.transform(resp))}},cancelLastRequest:function cancelLastRequest(){this.transport.cancel()}});return Remote}();var oParser=function(){"use strict";return function parse(o){var defaults,sorter;defaults={initialize:!0,identify:_.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null};o=_.mixin(defaults,o||{});!o.datumTokenizer&&$.error("datumTokenizer is required");!o.queryTokenizer&&$.error("queryTokenizer is required");sorter=o.sorter;o.sorter=sorter?function(x){return x.sort(sorter)}:_.identity;o.local=_.isFunction(o.local)?o.local():o.local;o.prefetch=parsePrefetch(o.prefetch);o.remote=parseRemote(o.remote);return o};function parsePrefetch(o){var defaults;if(!o){return null}
defaults={url:null,ttl:24*60*60*1e3,cache:!0,cacheKey:null,thumbprint:"",prepare:_.identity,transform:_.identity,transport:null};o=_.isString(o)?{url:o}:o;o=_.mixin(defaults,o);!o.url&&$.error("prefetch requires url to be set");o.transform=o.filter||o.transform;o.cacheKey=o.cacheKey||o.url;o.thumbprint=VERSION+o.thumbprint;o.transport=o.transport?callbackToDeferred(o.transport):$.ajax;return o}
function parseRemote(o){var defaults;if(!o){return}
defaults={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:_.identity,transport:null};o=_.isString(o)?{url:o}:o;o=_.mixin(defaults,o);!o.url&&$.error("remote requires url to be set");o.transform=o.filter||o.transform;o.prepare=toRemotePrepare(o);o.limiter=toLimiter(o);o.transport=o.transport?callbackToDeferred(o.transport):$.ajax;delete o.replace;delete o.wildcard;delete o.rateLimitBy;delete o.rateLimitWait;return o}
function toRemotePrepare(o){var prepare,replace,wildcard;prepare=o.prepare;replace=o.replace;wildcard=o.wildcard;if(prepare){return prepare}
if(replace){prepare=prepareByReplace}else if(o.wildcard){prepare=prepareByWildcard}else{prepare=idenityPrepare}
return prepare;function prepareByReplace(query,settings){settings.url=replace(settings.url,query);return settings}
function prepareByWildcard(query,settings){settings.url=settings.url.replace(wildcard,encodeURIComponent(query));return settings}
function idenityPrepare(query,settings){return settings}}
function toLimiter(o){var limiter,method,wait;limiter=o.limiter;method=o.rateLimitBy;wait=o.rateLimitWait;if(!limiter){limiter=/^throttle$/i.test(method)?throttle(wait):debounce(wait)}
return limiter;function debounce(wait){return function debounce(fn){return _.debounce(fn,wait)}}
function throttle(wait){return function throttle(fn){return _.throttle(fn,wait)}}}
function callbackToDeferred(fn){return function wrapper(o){var deferred=$.Deferred();fn(o,onSuccess,onError);return deferred;function onSuccess(resp){_.defer(function(){deferred.resolve(resp)})}
function onError(err){_.defer(function(){deferred.reject(err)})}}}}();var Bloodhound=function(){"use strict";var old;old=window&&window.Bloodhound;function Bloodhound(o){o=oParser(o);this.sorter=o.sorter;this.identify=o.identify;this.sufficient=o.sufficient;this.local=o.local;this.remote=o.remote?new Remote(o.remote):null;this.prefetch=o.prefetch?new Prefetch(o.prefetch):null;this.index=new SearchIndex({identify:this.identify,datumTokenizer:o.datumTokenizer,queryTokenizer:o.queryTokenizer});o.initialize!==!1&&this.initialize()}
Bloodhound.noConflict=function noConflict(){window&&(window.Bloodhound=old);return Bloodhound};Bloodhound.tokenizers=tokenizers;_.mixin(Bloodhound.prototype,{__ttAdapter:function ttAdapter(){var that=this;return this.remote?withAsync:withoutAsync;function withAsync(query,sync,async){return that.search(query,sync,async)}
function withoutAsync(query,sync){return that.search(query,sync)}},_loadPrefetch:function loadPrefetch(){var that=this,deferred,serialized;deferred=$.Deferred();if(!this.prefetch){deferred.resolve()}else if(serialized=this.prefetch.fromCache()){this.index.bootstrap(serialized);deferred.resolve()}else{this.prefetch.fromNetwork(done)}
return deferred.promise();function done(err,data){if(err){return deferred.reject()}
that.add(data);that.prefetch.store(that.index.serialize());deferred.resolve()}},_initialize:function initialize(){var that=this,deferred;this.clear();(this.initPromise=this._loadPrefetch()).done(addLocalToIndex);return this.initPromise;function addLocalToIndex(){that.add(that.local)}},initialize:function initialize(force){return!this.initPromise||force?this._initialize():this.initPromise},add:function add(data){this.index.add(data);return this},get:function get(ids){ids=_.isArray(ids)?ids:[].slice.call(arguments);return this.index.get(ids)},search:function search(query,sync,async){var that=this,local;local=this.sorter(this.index.search(query));sync(this.remote?local.slice():local);if(this.remote&&local.length<this.sufficient){this.remote.get(query,processRemote)}else if(this.remote){this.remote.cancelLastRequest()}
return this;function processRemote(remote){var nonDuplicates=[];_.each(remote,function(r){!_.some(local,function(l){return that.identify(r)===that.identify(l)})&&nonDuplicates.push(r)});async&&async(nonDuplicates)}},all:function all(){return this.index.all()},clear:function clear(){this.index.reset();return this},clearPrefetchCache:function clearPrefetchCache(){this.prefetch&&this.prefetch.clear();return this},clearRemoteCache:function clearRemoteCache(){Transport.resetCache();return this},ttAdapter:function ttAdapter(){return this.__ttAdapter()}});return Bloodhound}();return Bloodhound});(function(root,factory){if(typeof define==="function"&&define.amd){define("typeahead.js",["jquery"],function(a0){return factory(a0)})}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{factory(jQuery)}})(this,function($){var _=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return typeof obj==="string"},isNumber:function(obj){return typeof obj==="number"},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return typeof obj==="undefined"},isElement:function(obj){return!!(obj&&obj.nodeType===1)},isJQuery:function(obj){return obj instanceof $},toStr:function toStr(s){return _.isUndefined(s)||s===null?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,reverseArgs);function reverseArgs(index,value){return cb(value,index)}},map:$.map,filter:$.grep,every:function(obj,test){var result=!0;if(!obj){return result}
$.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj))){return!1}});return!!result},some:function(obj,test){var result=!1;if(!obj){return result}
$.each(obj,function(key,val){if(result=test.call(null,val,key,obj)){return!1}});return!!result},mixin:$.extend,identity:function(x){return x},clone:function(obj){return $.extend(!0,{},obj)},getIdGenerator:function(){var counter=0;return function(){return counter++}},templatify:function templatify(obj){return $.isFunction(obj)?obj:template;function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}
return result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;previous=0;later=function(){previous=new Date();timeout=null;result=func.apply(context,args)};return function(){var now=new Date(),remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}
return result}},stringify:function(val){return _.isString(val)?val:JSON.stringify(val)},noop:function(){}}}();var WWW=function(){"use strict";var defaultClassNames={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return build;function build(o){var www,classes;classes=_.mixin({},defaultClassNames,o);www={css:buildCss(),classes:classes,html:buildHtml(classes),selectors:buildSelectors(classes)};return{css:www.css,html:www.html,classes:www.classes,selectors:www.selectors,mixin:function(o){_.mixin(o,www)}}}
function buildHtml(c){return{wrapper:'<span class="'+c.wrapper+'"></span>',menu:'<div class="'+c.menu+'"></div>'}}
function buildSelectors(classes){var selectors={};_.each(classes,function(v,k){selectors[k]="."+v});return selectors}
function buildCss(){var css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};if(_.isMsie()){_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}
return css}}();var EventBus=function(){"use strict";var namespace,deprecationMap;namespace="typeahead:";deprecationMap={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"};function EventBus(o){if(!o||!o.el){$.error("EventBus initialized without el")}
this.$el=$(o.el)}
_.mixin(EventBus.prototype,{_trigger:function(type,args){var $e;$e=$.Event(namespace+type);(args=args||[]).unshift($e);this.$el.trigger.apply(this.$el,args);return $e},before:function(type){var args,$e;args=[].slice.call(arguments,1);$e=this._trigger("before"+type,args);return $e.isDefaultPrevented()},trigger:function(type){var deprecatedType;this._trigger(type,[].slice.call(arguments,1));if(deprecatedType=deprecationMap[type]){this._trigger(deprecatedType,[].slice.call(arguments,1))}}});return EventBus}();var EventEmitter=function(){"use strict";var splitter=/\s+/,nextTick=getNextTick();return{onSync:onSync,onAsync:onAsync,off:off,trigger:trigger};function on(method,types,cb,context){var type;if(!cb){return this}
types=types.split(splitter);cb=context?bindContext(cb,context):cb;this._callbacks=this._callbacks||{};while(type=types.shift()){this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]};this._callbacks[type][method].push(cb)}
return this}
function onAsync(types,cb,context){return on.call(this,"async",types,cb,context)}
function onSync(types,cb,context){return on.call(this,"sync",types,cb,context)}
function off(types){var type;if(!this._callbacks){return this}
types=types.split(splitter);while(type=types.shift()){delete this._callbacks[type]}
return this}
function trigger(types){var type,callbacks,args,syncFlush,asyncFlush;if(!this._callbacks){return this}
types=types.split(splitter);args=[].slice.call(arguments,1);while((type=types.shift())&&(callbacks=this._callbacks[type])){syncFlush=getFlush(callbacks.sync,this,[type].concat(args));asyncFlush=getFlush(callbacks.async,this,[type].concat(args));syncFlush()&&nextTick(asyncFlush)}
return this}
function getFlush(callbacks,context,args){return flush;function flush(){var cancelled;for(var i=0,len=callbacks.length;!cancelled&&i<len;i+=1){cancelled=callbacks[i].apply(context,args)===!1}
return!cancelled}}
function getNextTick(){var nextTickFn;if(window.setImmediate){nextTickFn=function nextTickSetImmediate(fn){setImmediate(function(){fn()})}}else{nextTickFn=function nextTickSetTimeout(fn){setTimeout(function(){fn()},0)}}
return nextTickFn}
function bindContext(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}}();var highlight=function(doc){"use strict";var defaults={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function hightlight(o){var regex;o=_.mixin({},defaults,o);if(!o.node||!o.pattern){return}
o.pattern=_.isArray(o.pattern)?o.pattern:[o.pattern];regex=getRegex(o.pattern,o.caseSensitive,o.wordsOnly);traverse(o.node,hightlightTextNode);function hightlightTextNode(textNode){var match,patternNode,wrapperNode;if(match=regex.exec(textNode.data)){wrapperNode=doc.createElement(o.tagName);o.className&&(wrapperNode.className=o.className);patternNode=textNode.splitText(match.index);patternNode.splitText(match[0].length);wrapperNode.appendChild(patternNode.cloneNode(!0));textNode.parentNode.replaceChild(wrapperNode,patternNode)}
return!!match}
function traverse(el,hightlightTextNode){var childNode,TEXT_NODE_TYPE=3;for(var i=0;i<el.childNodes.length;i++){childNode=el.childNodes[i];if(childNode.nodeType===TEXT_NODE_TYPE){i+=hightlightTextNode(childNode)?1:0}else{traverse(childNode,hightlightTextNode)}}}};function getRegex(patterns,caseSensitive,wordsOnly){var escapedPatterns=[],regexStr;for(var i=0,len=patterns.length;i<len;i++){escapedPatterns.push(_.escapeRegExChars(patterns[i]))}
regexStr=wordsOnly?"\\b("+escapedPatterns.join("|")+")\\b":"("+escapedPatterns.join("|")+")";return caseSensitive?new RegExp(regexStr):new RegExp(regexStr,"i")}}(window.document);var Input=function(){"use strict";var specialKeyCodeMap;specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};function Input(o,www){o=o||{};if(!o.input){$.error("input is missing")}
www.mixin(this);this.$hint=$(o.hint);this.$input=$(o.input);this.query=this.$input.val();this.queryWhenFocused=this.hasFocus()?this.query:null;this.$overflowHelper=buildOverflowHelper(this.$input);this._checkLanguageDirection();if(this.$hint.length===0){this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop}}
Input.normalizeQuery=function(str){return _.toStr(str).replace(/^\s*/g,"").replace(/\s{2,}/g," ")};_.mixin(Input.prototype,EventEmitter,{_onBlur:function onBlur(){this.resetInputValue();this.trigger("blurred")},_onFocus:function onFocus(){this.queryWhenFocused=this.query;this.trigger("focused")},_onKeydown:function onKeydown($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e);if(keyName&&this._shouldTrigger(keyName,$e)){this.trigger(keyName+"Keyed",$e)}},_onInput:function onInput(){this._setQuery(this.getInputValue());this.clearHintIfInvalid();this._checkLanguageDirection()},_managePreventDefault:function managePreventDefault(keyName,$e){var preventDefault;switch(keyName){case "up":case "down":preventDefault=!withModifier($e);break;default:preventDefault=!1}
preventDefault&&$e.preventDefault()},_shouldTrigger:function shouldTrigger(keyName,$e){var trigger;switch(keyName){case "tab":trigger=!withModifier($e);break;default:trigger=!0}
return trigger},_checkLanguageDirection:function checkLanguageDirection(){var dir=(this.$input.css("direction")||"ltr").toLowerCase();if(this.dir!==dir){this.dir=dir;this.$hint.attr("dir",dir);this.trigger("langDirChanged",dir)}},_setQuery:function setQuery(val,silent){var areEquivalent,hasDifferentWhitespace;areEquivalent=areQueriesEquivalent(val,this.query);hasDifferentWhitespace=areEquivalent?this.query.length!==val.length:!1;this.query=val;if(!silent&&!areEquivalent){this.trigger("queryChanged",this.query)}else if(!silent&&hasDifferentWhitespace){this.trigger("whitespaceChanged",this.query)}},bind:function(){var that=this,onBlur,onFocus,onKeydown,onInput;onBlur=_.bind(this._onBlur,this);onFocus=_.bind(this._onFocus,this);onKeydown=_.bind(this._onKeydown,this);onInput=_.bind(this._onInput,this);this.$input.on("blur.tt",onBlur).on("focus.tt",onFocus).on("keydown.tt",onKeydown);if(!_.isMsie()||_.isMsie()>9){this.$input.on("input.tt",onInput)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function($e){if(specialKeyCodeMap[$e.which||$e.keyCode]){return}
_.defer(_.bind(that._onInput,that,$e))})}
return this},focus:function focus(){this.$input.focus()},blur:function blur(){this.$input.blur()},getLangDir:function getLangDir(){return this.dir},getQuery:function getQuery(){return this.query||""},setQuery:function setQuery(val,silent){this.setInputValue(val);this._setQuery(val,silent)},hasQueryChangedSinceLastFocus:function hasQueryChangedSinceLastFocus(){return this.query!==this.queryWhenFocused},getInputValue:function getInputValue(){return this.$input.val()},setInputValue:function setInputValue(value){this.$input.val(value);this.clearHintIfInvalid();this._checkLanguageDirection()},resetInputValue:function resetInputValue(){this.setInputValue(this.query)},getHint:function getHint(){return this.$hint.val()},setHint:function setHint(value){this.$hint.val(value)},clearHint:function clearHint(){this.setHint("")},clearHintIfInvalid:function clearHintIfInvalid(){var val,hint,valIsPrefixOfHint,isValid;val=this.getInputValue();hint=this.getHint();valIsPrefixOfHint=val!==hint&&hint.indexOf(val)===0;isValid=val!==""&&valIsPrefixOfHint&&!this.hasOverflow();!isValid&&this.clearHint()},hasFocus:function hasFocus(){return this.$input.is(":focus")},hasOverflow:function hasOverflow(){var constraint=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength,selectionStart,range;valueLength=this.$input.val().length;selectionStart=this.$input[0].selectionStart;if(_.isNumber(selectionStart)){return selectionStart===valueLength}else if(document.selection){range=document.selection.createRange();range.moveStart("character",-valueLength);return valueLength===range.text.length}
return!0},destroy:function destroy(){this.$hint.off(".tt");this.$input.off(".tt");this.$overflowHelper.remove();this.$hint=this.$input=this.$overflowHelper=$("<div>")}});return Input;function buildOverflowHelper($input){return $('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input)}
function areQueriesEquivalent(a,b){return Input.normalizeQuery(a)===Input.normalizeQuery(b)}
function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}}();var Dataset=function(){"use strict";var keys,nameGenerator;keys={val:"tt-selectable-display",obj:"tt-selectable-object"};nameGenerator=_.getIdGenerator();function Dataset(o,www){o=o||{};o.templates=o.templates||{};o.templates.notFound=o.templates.notFound||o.templates.empty;if(!o.source){$.error("missing source")}
if(!o.node){$.error("missing node")}
if(o.name&&!isValidName(o.name)){$.error("invalid dataset name: "+o.name)}
www.mixin(this);this.highlight=!!o.highlight;this.name=o.name||nameGenerator();this.limit=o.limit||5;this.displayFn=getDisplayFn(o.display||o.displayKey);this.templates=getTemplates(o.templates,this.displayFn);this.source=o.source.__ttAdapter?o.source.__ttAdapter():o.source;this.async=_.isUndefined(o.async)?this.source.length>2:!!o.async;this._resetLastSuggestion();this.$el=$(o.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}
Dataset.extractData=function extractData(el){var $el=$(el);if($el.data(keys.obj)){return{val:$el.data(keys.val)||"",obj:$el.data(keys.obj)||null}}
return null};_.mixin(Dataset.prototype,EventEmitter,{_overwrite:function overwrite(query,suggestions){suggestions=suggestions||[];if(suggestions.length){this._renderSuggestions(query,suggestions)}else if(this.async&&this.templates.pending){this._renderPending(query)}else if(!this.async&&this.templates.notFound){this._renderNotFound(query)}else{this._empty()}
this.trigger("rendered",this.name,suggestions,!1)},_append:function append(query,suggestions){suggestions=suggestions||[];if(suggestions.length&&this.$lastSuggestion.length){this._appendSuggestions(query,suggestions)}else if(suggestions.length){this._renderSuggestions(query,suggestions)}else if(!this.$lastSuggestion.length&&this.templates.notFound){this._renderNotFound(query)}
this.trigger("rendered",this.name,suggestions,!0)},_renderSuggestions:function renderSuggestions(query,suggestions){var $fragment;$fragment=this._getSuggestionsFragment(query,suggestions);this.$lastSuggestion=$fragment.children().last();this.$el.html($fragment).prepend(this._getHeader(query,suggestions)).append(this._getFooter(query,suggestions))},_appendSuggestions:function appendSuggestions(query,suggestions){var $fragment,$lastSuggestion;$fragment=this._getSuggestionsFragment(query,suggestions);$lastSuggestion=$fragment.children().last();this.$lastSuggestion.after($fragment);this.$lastSuggestion=$lastSuggestion},_renderPending:function renderPending(query){var template=this.templates.pending;this._resetLastSuggestion();template&&this.$el.html(template({query:query,dataset:this.name}))},_renderNotFound:function renderNotFound(query){var template=this.templates.notFound;this._resetLastSuggestion();template&&this.$el.html(template({query:query,dataset:this.name}))},_empty:function empty(){this.$el.empty();this._resetLastSuggestion()},_getSuggestionsFragment:function getSuggestionsFragment(query,suggestions){var that=this,fragment;fragment=document.createDocumentFragment();_.each(suggestions,function getSuggestionNode(suggestion){var $el,context;context=that._injectQuery(query,suggestion);$el=$(that.templates.suggestion(context)).data(keys.obj,suggestion).data(keys.val,that.displayFn(suggestion)).addClass(that.classes.suggestion+" "+that.classes.selectable);fragment.appendChild($el[0])});this.highlight&&highlight({className:this.classes.highlight,node:fragment,pattern:query});return $(fragment)},_getFooter:function getFooter(query,suggestions){return this.templates.footer?this.templates.footer({query:query,suggestions:suggestions,dataset:this.name}):null},_getHeader:function getHeader(query,suggestions){return this.templates.header?this.templates.header({query:query,suggestions:suggestions,dataset:this.name}):null},_resetLastSuggestion:function resetLastSuggestion(){this.$lastSuggestion=$()},_injectQuery:function injectQuery(query,obj){return _.isObject(obj)?_.mixin({_query:query},obj):obj},update:function update(query){var that=this,canceled=!1,syncCalled=!1,rendered=0;this.cancel();this.cancel=function cancel(){canceled=!0;that.cancel=$.noop;that.async&&that.trigger("asyncCanceled",query)};this.source(query,sync,async);!syncCalled&&sync([]);function sync(suggestions){if(syncCalled){return}
syncCalled=!0;suggestions=(suggestions||[]).slice(0,that.limit);rendered=suggestions.length;that._overwrite(query,suggestions);if(rendered<that.limit&&that.async){that.trigger("asyncRequested",query)}}
function async(suggestions){suggestions=suggestions||[];if(!canceled&&rendered<that.limit){that.cancel=$.noop;rendered+=suggestions.length;that._append(query,suggestions.slice(0,that.limit-rendered));that.async&&that.trigger("asyncReceived",query)}}},cancel:$.noop,clear:function clear(){this._empty();this.cancel();this.trigger("cleared")},isEmpty:function isEmpty(){return this.$el.is(":empty")},destroy:function destroy(){this.$el=$("<div>")}});return Dataset;function getDisplayFn(display){display=display||_.stringify;return _.isFunction(display)?display:displayFn;function displayFn(obj){return obj[display]}}
function getTemplates(templates,displayFn){return{notFound:templates.notFound&&_.templatify(templates.notFound),pending:templates.pending&&_.templatify(templates.pending),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||suggestionTemplate};function suggestionTemplate(context){return $("<div>").text(displayFn(context))}}
function isValidName(str){return/^[_a-zA-Z0-9-]+$/.test(str)}}();var Menu=function(){"use strict";function Menu(o,www){var that=this;o=o||{};if(!o.node){$.error("node is required")}
www.mixin(this);this.$node=$(o.node);this.query=null;this.datasets=_.map(o.datasets,initializeDataset);function initializeDataset(oDataset){var node=that.$node.find(oDataset.node).first();oDataset.node=node.length?node:$("<div>").appendTo(that.$node);return new Dataset(oDataset,www)}}
_.mixin(Menu.prototype,EventEmitter,{_onSelectableClick:function onSelectableClick($e){this.trigger("selectableClicked",$($e.currentTarget))},_onRendered:function onRendered(type,dataset,suggestions,async){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetRendered",dataset,suggestions,async)},_onCleared:function onCleared(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetCleared")},_propagate:function propagate(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function allDatasetsEmpty(){return _.every(this.datasets,isDatasetEmpty);function isDatasetEmpty(dataset){return dataset.isEmpty()}},_getSelectables:function getSelectables(){return this.$node.find(this.selectors.selectable)},_removeCursor:function _removeCursor(){var $selectable=this.getActiveSelectable();$selectable&&$selectable.removeClass(this.classes.cursor)},_ensureVisible:function ensureVisible($el){var elTop,elBottom,nodeScrollTop,nodeHeight;elTop=$el.position().top;elBottom=elTop+$el.outerHeight(!0);nodeScrollTop=this.$node.scrollTop();nodeHeight=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10);if(elTop<0){this.$node.scrollTop(nodeScrollTop+elTop)}else if(nodeHeight<elBottom){this.$node.scrollTop(nodeScrollTop+(elBottom-nodeHeight))}},bind:function(){var that=this,onSelectableClick;onSelectableClick=_.bind(this._onSelectableClick,this);this.$node.on("click.tt",this.selectors.selectable,onSelectableClick);_.each(this.datasets,function(dataset){dataset.onSync("asyncRequested",that._propagate,that).onSync("asyncCanceled",that._propagate,that).onSync("asyncReceived",that._propagate,that).onSync("rendered",that._onRendered,that).onSync("cleared",that._onCleared,that)});return this},isOpen:function isOpen(){return this.$node.hasClass(this.classes.open)},open:function open(){this.$node.addClass(this.classes.open)},close:function close(){this.$node.removeClass(this.classes.open);this._removeCursor()},setLanguageDirection:function setLanguageDirection(dir){this.$node.attr("dir",dir)},selectableRelativeToCursor:function selectableRelativeToCursor(delta){var $selectables,$oldCursor,oldIndex,newIndex;$oldCursor=this.getActiveSelectable();$selectables=this._getSelectables();oldIndex=$oldCursor?$selectables.index($oldCursor):-1;newIndex=oldIndex+delta;newIndex=(newIndex+1)%($selectables.length+1)-1;newIndex=newIndex<-1?$selectables.length-1:newIndex;return newIndex===-1?null:$selectables.eq(newIndex)},setCursor:function setCursor($selectable){this._removeCursor();if($selectable=$selectable&&$selectable.first()){$selectable.addClass(this.classes.cursor);this._ensureVisible($selectable)}},getSelectableData:function getSelectableData($el){return $el&&$el.length?Dataset.extractData($el):null},getActiveSelectable:function getActiveSelectable(){var $selectable=this._getSelectables().filter(this.selectors.cursor).first();return $selectable.length?$selectable:null},getTopSelectable:function getTopSelectable(){var $selectable=this._getSelectables().first();return $selectable.length?$selectable:null},update:function update(query){var isValidUpdate=query!==this.query;if(isValidUpdate){this.query=query;_.each(this.datasets,updateDataset)}
return isValidUpdate;function updateDataset(dataset){dataset.update(query)}},empty:function empty(){_.each(this.datasets,clearDataset);this.query=null;this.$node.addClass(this.classes.empty);function clearDataset(dataset){dataset.clear()}},destroy:function destroy(){this.$node.off(".tt");this.$node=$("<div>");_.each(this.datasets,destroyDataset);function destroyDataset(dataset){dataset.destroy()}}});return Menu}();var DefaultMenu=function(){"use strict";var s=Menu.prototype;function DefaultMenu(){Menu.apply(this,[].slice.call(arguments,0))}
_.mixin(DefaultMenu.prototype,Menu.prototype,{open:function open(){!this._allDatasetsEmpty()&&this._show();return s.open.apply(this,[].slice.call(arguments,0))},close:function close(){this._hide();return s.close.apply(this,[].slice.call(arguments,0))},_onRendered:function onRendered(){if(this._allDatasetsEmpty()){this._hide()}else{this.isOpen()&&this._show()}
return s._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function onCleared(){if(this._allDatasetsEmpty()){this._hide()}else{this.isOpen()&&this._show()}
return s._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function setLanguageDirection(dir){this.$node.css(dir==="ltr"?this.css.ltr:this.css.rtl);return s.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function hide(){this.$node.hide()},_show:function show(){this.$node.css("display","block")}});return DefaultMenu}();var Typeahead=function(){"use strict";function Typeahead(o,www){var onFocused,onBlurred,onEnterKeyed,onTabKeyed,onEscKeyed,onUpKeyed,onDownKeyed,onLeftKeyed,onRightKeyed,onQueryChanged,onWhitespaceChanged;o=o||{};if(!o.input){$.error("missing input")}
if(!o.menu){$.error("missing menu")}
if(!o.eventBus){$.error("missing event bus")}
www.mixin(this);this.eventBus=o.eventBus;this.minLength=_.isNumber(o.minLength)?o.minLength:1;this.input=o.input;this.menu=o.menu;this.enabled=!0;this.active=!1;this.input.hasFocus()&&this.activate();this.dir=this.input.getLangDir();this._hacks();this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this);onFocused=c(this,"activate","open","_onFocused");onBlurred=c(this,"deactivate","_onBlurred");onEnterKeyed=c(this,"isActive","isOpen","_onEnterKeyed");onTabKeyed=c(this,"isActive","isOpen","_onTabKeyed");onEscKeyed=c(this,"isActive","_onEscKeyed");onUpKeyed=c(this,"isActive","open","_onUpKeyed");onDownKeyed=c(this,"isActive","open","_onDownKeyed");onLeftKeyed=c(this,"isActive","isOpen","_onLeftKeyed");onRightKeyed=c(this,"isActive","isOpen","_onRightKeyed");onQueryChanged=c(this,"_openIfActive","_onQueryChanged");onWhitespaceChanged=c(this,"_openIfActive","_onWhitespaceChanged");this.input.bind().onSync("focused",onFocused,this).onSync("blurred",onBlurred,this).onSync("enterKeyed",onEnterKeyed,this).onSync("tabKeyed",onTabKeyed,this).onSync("escKeyed",onEscKeyed,this).onSync("upKeyed",onUpKeyed,this).onSync("downKeyed",onDownKeyed,this).onSync("leftKeyed",onLeftKeyed,this).onSync("rightKeyed",onRightKeyed,this).onSync("queryChanged",onQueryChanged,this).onSync("whitespaceChanged",onWhitespaceChanged,this).onSync("langDirChanged",this._onLangDirChanged,this)}
_.mixin(Typeahead.prototype,{_hacks:function hacks(){var $input,$menu;$input=this.input.$input||$("<div>");$menu=this.menu.$node||$("<div>");$input.on("blur.tt",function($e){var active,isActive,hasActive;active=document.activeElement;isActive=$menu.is(active);hasActive=$menu.has(active).length>0;if(_.isMsie()&&(isActive||hasActive)){$e.preventDefault();$e.stopImmediatePropagation();_.defer(function(){$input.focus()})}});$menu.on("mousedown.tt",function($e){$e.preventDefault()})},_onSelectableClicked:function onSelectableClicked(type,$el){this.select($el)},_onDatasetCleared:function onDatasetCleared(){this._updateHint()},_onDatasetRendered:function onDatasetRendered(type,dataset,suggestions,async){this._updateHint();this.eventBus.trigger("render",suggestions,async,dataset)},_onAsyncRequested:function onAsyncRequested(type,dataset,query){this.eventBus.trigger("asyncrequest",query,dataset)},_onAsyncCanceled:function onAsyncCanceled(type,dataset,query){this.eventBus.trigger("asynccancel",query,dataset)},_onAsyncReceived:function onAsyncReceived(type,dataset,query){this.eventBus.trigger("asyncreceive",query,dataset)},_onFocused:function onFocused(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function onBlurred(){if(this.input.hasQueryChangedSinceLastFocus()){this.eventBus.trigger("change",this.input.getQuery())}},_onEnterKeyed:function onEnterKeyed(type,$e){var $selectable;if($selectable=this.menu.getActiveSelectable()){this.select($selectable)&&$e.preventDefault()}},_onTabKeyed:function onTabKeyed(type,$e){var $selectable;if($selectable=this.menu.getActiveSelectable()){this.select($selectable)&&$e.preventDefault()}else if($selectable=this.menu.getTopSelectable()){this.autocomplete($selectable)&&$e.preventDefault()}},_onEscKeyed:function onEscKeyed(){this.close()},_onUpKeyed:function onUpKeyed(){this.moveCursor(-1)},_onDownKeyed:function onDownKeyed(){this.moveCursor(+1)},_onLeftKeyed:function onLeftKeyed(){if(this.dir==="rtl"&&this.input.isCursorAtEnd()){this.autocomplete(this.menu.getTopSelectable())}},_onRightKeyed:function onRightKeyed(){if(this.dir==="ltr"&&this.input.isCursorAtEnd()){this.autocomplete(this.menu.getTopSelectable())}},_onQueryChanged:function onQueryChanged(e,query){this._minLengthMet(query)?this.menu.update(query):this.menu.empty()},_onWhitespaceChanged:function onWhitespaceChanged(){this._updateHint()},_onLangDirChanged:function onLangDirChanged(e,dir){if(this.dir!==dir){this.dir=dir;this.menu.setLanguageDirection(dir)}},_openIfActive:function openIfActive(){this.isActive()&&this.open()},_minLengthMet:function minLengthMet(query){query=_.isString(query)?query:this.input.getQuery()||"";return query.length>=this.minLength},_updateHint:function updateHint(){var $selectable,data,val,query,escapedQuery,frontMatchRegEx,match;$selectable=this.menu.getTopSelectable();data=this.menu.getSelectableData($selectable);val=this.input.getInputValue();if(data&&!_.isBlankString(val)&&!this.input.hasOverflow()){query=Input.normalizeQuery(val);escapedQuery=_.escapeRegExChars(query);frontMatchRegEx=new RegExp("^(?:"+escapedQuery+")(.+$)","i");match=frontMatchRegEx.exec(data.val);match&&this.input.setHint(val+match[1])}else{this.input.clearHint()}},isEnabled:function isEnabled(){return this.enabled},enable:function enable(){this.enabled=!0},disable:function disable(){this.enabled=!1},isActive:function isActive(){return this.active},activate:function activate(){if(this.isActive()){return!0}else if(!this.isEnabled()||this.eventBus.before("active")){return!1}else{this.active=!0;this.eventBus.trigger("active");return!0}},deactivate:function deactivate(){if(!this.isActive()){return!0}else if(this.eventBus.before("idle")){return!1}else{this.active=!1;this.close();this.eventBus.trigger("idle");return!0}},isOpen:function isOpen(){return this.menu.isOpen()},open:function open(){if(!this.isOpen()&&!this.eventBus.before("open")){this.menu.open();this._updateHint();this.eventBus.trigger("open")}
return this.isOpen()},close:function close(){if(this.isOpen()&&!this.eventBus.before("close")){this.menu.close();this.input.clearHint();this.input.resetInputValue();this.eventBus.trigger("close")}
return!this.isOpen()},setVal:function setVal(val){this.input.setQuery(_.toStr(val))},getVal:function getVal(){return this.input.getQuery()},select:function select($selectable){var data=this.menu.getSelectableData($selectable);if(data&&!this.eventBus.before("select",data.obj)){this.input.setQuery(data.val,!0);this.eventBus.trigger("select",data.obj);this.close();return!0}
return!1},autocomplete:function autocomplete($selectable){var query,data,isValid;query=this.input.getQuery();data=this.menu.getSelectableData($selectable);isValid=data&&query!==data.val;if(isValid&&!this.eventBus.before("autocomplete",data.obj)){this.input.setQuery(data.val);this.eventBus.trigger("autocomplete",data.obj);return!0}
return!1},moveCursor:function moveCursor(delta){var query,$candidate,data,payload,cancelMove;query=this.input.getQuery();$candidate=this.menu.selectableRelativeToCursor(delta);data=this.menu.getSelectableData($candidate);payload=data?data.obj:null;cancelMove=this._minLengthMet()&&this.menu.update(query);if(!cancelMove&&!this.eventBus.before("cursorchange",payload)){this.menu.setCursor($candidate);if(data){this.input.setInputValue(data.val)}else{this.input.resetInputValue();this._updateHint()}
this.eventBus.trigger("cursorchange",payload);return!0}
return!1},destroy:function destroy(){this.input.destroy();this.menu.destroy()}});return Typeahead;function c(ctx){var methods=[].slice.call(arguments,1);return function(){var args=[].slice.call(arguments);_.each(methods,function(method){return ctx[method].apply(ctx,args)})}}}();(function(){"use strict";var old,keys,methods;old=$.fn.typeahead;keys={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"};methods={initialize:function initialize(o,datasets){var www;datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,1);o=o||{};www=WWW(o.classNames);return this.each(attach);function attach(){var $input,$wrapper,$hint,$menu,defaultHint,defaultMenu,eventBus,input,menu,typeahead,MenuConstructor;_.each(datasets,function(d){d.highlight=!!o.highlight});$input=$(this);$wrapper=$(www.html.wrapper);$hint=$elOrNull(o.hint);$menu=$elOrNull(o.menu);defaultHint=o.hint!==!1&&!$hint;defaultMenu=o.menu!==!1&&!$menu;defaultHint&&($hint=buildHintFromInput($input,www));defaultMenu&&($menu=$(www.html.menu).css(www.css.menu));$hint&&$hint.val("");$input=prepInput($input,www);if(defaultHint||defaultMenu){$wrapper.css(www.css.wrapper);$input.css(defaultHint?www.css.input:www.css.inputWithNoHint);$input.wrap($wrapper).parent().prepend(defaultHint?$hint:null).append(defaultMenu?$menu:null)}
MenuConstructor=defaultMenu?DefaultMenu:Menu;eventBus=new EventBus({el:$input});input=new Input({hint:$hint,input:$input},www);menu=new MenuConstructor({node:$menu,datasets:datasets},www);typeahead=new Typeahead({input:input,menu:menu,eventBus:eventBus,minLength:o.minLength},www);$input.data(keys.www,www);$input.data(keys.typeahead,typeahead)}},isEnabled:function isEnabled(){var enabled;ttEach(this.first(),function(t){enabled=t.isEnabled()});return enabled},enable:function enable(){ttEach(this,function(t){t.enable()});return this},disable:function disable(){ttEach(this,function(t){t.disable()});return this},isActive:function isActive(){var active;ttEach(this.first(),function(t){active=t.isActive()});return active},activate:function activate(){ttEach(this,function(t){t.activate()});return this},deactivate:function deactivate(){ttEach(this,function(t){t.deactivate()});return this},isOpen:function isOpen(){var open;ttEach(this.first(),function(t){open=t.isOpen()});return open},open:function open(){ttEach(this,function(t){t.open()});return this},close:function close(){ttEach(this,function(t){t.close()});return this},select:function select(el){var success=!1,$el=$(el);ttEach(this.first(),function(t){success=t.select($el)});return success},autocomplete:function autocomplete(el){var success=!1,$el=$(el);ttEach(this.first(),function(t){success=t.autocomplete($el)});return success},moveCursor:function moveCursoe(delta){var success=!1;ttEach(this.first(),function(t){success=t.moveCursor(delta)});return success},val:function val(newVal){var query;if(!arguments.length){ttEach(this.first(),function(t){query=t.getVal()});return query}else{ttEach(this,function(t){t.setVal(newVal)});return this}},destroy:function destroy(){ttEach(this,function(typeahead,$input){revert($input);typeahead.destroy()});return this}};$.fn.typeahead=function(method){if(methods[method]){return methods[method].apply(this,[].slice.call(arguments,1))}else{return methods.initialize.apply(this,arguments)}};$.fn.typeahead.noConflict=function noConflict(){$.fn.typeahead=old;return this};function ttEach($els,fn){$els.each(function(){var $input=$(this),typeahead;(typeahead=$input.data(keys.typeahead))&&fn(typeahead,$input)})}
function buildHintFromInput($input,www){return $input.clone().addClass(www.classes.hint).removeData().css(www.css.hint).css(getBackgroundStyles($input)).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}
function prepInput($input,www){$input.data(keys.attrs,{dir:$input.attr("dir"),autocomplete:$input.attr("autocomplete"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style")});$input.addClass(www.classes.input).attr({autocomplete:"off",spellcheck:!1});try{!$input.attr("dir")&&$input.attr("dir","auto")}catch(e){}
return $input}
function getBackgroundStyles($el){return{backgroundAttachment:$el.css("background-attachment"),backgroundClip:$el.css("background-clip"),backgroundColor:$el.css("background-color"),backgroundImage:$el.css("background-image"),backgroundOrigin:$el.css("background-origin"),backgroundPosition:$el.css("background-position"),backgroundRepeat:$el.css("background-repeat"),backgroundSize:$el.css("background-size")}}
function revert($input){var www,$wrapper;www=$input.data(keys.www);$wrapper=$input.parent().filter(www.selectors.wrapper);_.each($input.data(keys.attrs),function(val,key){_.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)});$input.removeData(keys.typeahead).removeData(keys.www).removeData(keys.attr).removeClass(www.classes.input);if($wrapper.length){$input.detach().insertAfter($wrapper);$wrapper.remove()}}
function $elOrNull(obj){var isValid,$el;isValid=_.isJQuery(obj)||_.isElement(obj);$el=isValid?$(obj).first():[];return $el.length?$el:null}})()})